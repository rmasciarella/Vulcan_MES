# Frontend Environment Variables Documentation

This document provides comprehensive documentation for all environment variables used by the Vulcan MES frontend application.

## Overview

The frontend uses Next.js environment variable patterns with strict validation through Zod schemas. Variables are categorized into:

- **Client (Public) Variables**: Prefixed with `NEXT_PUBLIC_` and exposed to the browser
- **Server-Only Variables**: Available only during server-side rendering and API routes

## Client (Public) Variables

These variables are bundled into the client-side JavaScript and are visible to end users. They must be prefixed with `NEXT_PUBLIC_`.

### Core Supabase Configuration

#### `NEXT_PUBLIC_SUPABASE_URL`
- **Type**: String (URL)
- **Required**: Yes
- **Description**: The public URL of your Supabase project
- **Example**: `https://your-project.supabase.co`
- **Validation**: Must be a valid URL format
- **Production Notes**: This URL is publicly visible in the browser

#### `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY`
- **Type**: String
- **Required**: Yes
- **Description**: Supabase publishable (anonymous) key for client-side authentication
- **Example**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
- **Legacy Alias**: `NEXT_PUBLIC_SUPABASE_ANON_KEY` (deprecated, use canonical name)
- **Validation**: Must be non-empty string
- **Production Notes**: This key is safe to expose publicly as it only allows anonymous access

### Application Configuration

#### `NEXT_PUBLIC_APP_NAME`
- **Type**: String
- **Required**: No
- **Default**: `"Vulcan MES"`
- **Description**: Display name for the application shown in UI elements
- **Example**: `"Vulcan Manufacturing System"`
- **Usage**: Used in page titles, headers, and branding elements

#### `NEXT_PUBLIC_APP_ENV`
- **Type**: Enum
- **Required**: No
- **Default**: `"development"`
- **Allowed Values**: `"development"`, `"staging"`, `"production"`
- **Description**: Deployment environment identifier
- **Usage**: Controls environment-specific behavior and UI indicators
- **Production Notes**: Should be set to `"production"` in production deployments

### Development & Debug Configuration

#### `NEXT_PUBLIC_ENABLE_DEBUG_UI`
- **Type**: String (converted to Boolean)
- **Required**: No
- **Default**: `"false"`
- **Accepted Values**: `"true"`, `"false"`
- **Description**: Enables debug UI components and development tools
- **Usage**: Shows performance metrics, state inspection tools, and debug panels
- **Production Notes**: **MUST be `"false"` in production** to prevent exposing debug information

#### `NEXT_PUBLIC_ENABLE_MOCK_DATA`
- **Type**: String (converted to Boolean)
- **Required**: No
- **Default**: `"false"`
- **Accepted Values**: `"true"`, `"false"`
- **Description**: Enables mock data instead of real API calls
- **Usage**: Useful for development, testing, and demos
- **Production Notes**: **MUST be `"false"` in production** to prevent using mock data in live systems

### Health Check Configuration

#### `NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK`
- **Type**: String (converted to Boolean)
- **Required**: No
- **Default**: `"false"`
- **Accepted Values**: `"true"`, `"false"`
- **Description**: Enable database health monitoring for active system status tracking
- **Usage**: Controls whether the frontend periodically checks database connectivity and displays health status indicators
- **Performance Impact**: When enabled, performs periodic health checks that consume database connections
- **Production Notes**: Set to `"true"` only for critical dashboards or monitoring interfaces where real-time health status is essential

#### `NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS`
- **Type**: String (converted to Number in milliseconds)
- **Required**: No
- **Default**: `"300000"` (5 minutes)
- **Description**: Interval between health checks when active monitoring is enabled
- **Usage**: Determines how frequently the system performs database health checks
- **Performance Considerations**: 
  - Lower values provide more real-time status but increase database load
  - Higher values reduce load but may delay detection of issues
- **Production Notes**: Use 300000 (5 minutes) or higher to minimize database load and connection pool pressure

#### `NEXT_PUBLIC_DB_HEALTH_CHECK_MAX_INTERVAL_MS`
- **Type**: String (converted to Number in milliseconds)
- **Required**: No
- **Default**: `"3600000"` (1 hour)
- **Description**: Maximum interval for exponential backoff during health check failures
- **Usage**: When health checks fail, the system uses exponential backoff up to this maximum interval before retrying
- **Failure Recovery**: Prevents overwhelming a failing database with excessive retry attempts
- **Production Notes**: Recommended 3600000 (1 hour) to prevent excessive retries while still providing reasonable recovery detection

#### Health Check Usage Examples

**Development Environment** (frequent monitoring):
```bash
NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=true
NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS=60000    # 1 minute for rapid feedback
NEXT_PUBLIC_DB_HEALTH_CHECK_MAX_INTERVAL_MS=600000  # 10 minutes max backoff
```

**Production Dashboard** (balanced monitoring):
```bash
NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=true
NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS=300000   # 5 minutes standard
NEXT_PUBLIC_DB_HEALTH_CHECK_MAX_INTERVAL_MS=3600000  # 1 hour max backoff
```

**Production Application** (disabled for performance):
```bash
NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=false
# Other health check variables are ignored when disabled
```

#### Performance Considerations

- **Database Load**: Each health check consumes a database connection and performs a simple query
- **Connection Pool Impact**: Frequent health checks can reduce available connections for application queries
- **Network Overhead**: Health checks generate additional network traffic between frontend and database
- **Browser Resources**: Active monitoring uses browser timers and may impact performance on resource-constrained devices
- **Exponential Backoff**: Automatically reduces check frequency during failures to prevent cascade issues

## Server-Only Variables

These variables are only available on the server-side and are never exposed to the browser.

### Authentication & Security

#### `SUPABASE_SECRET`
- **Type**: String
- **Required**: Yes
- **Description**: Supabase service role key for server-side operations
- **Example**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
- **Legacy Alias**: `SUPABASE_SERVICE_KEY` (deprecated, use canonical name)
- **Validation**: Must be non-empty string
- **Security**: **Never expose this key publicly** - it grants admin access to your Supabase project
- **Usage**: Server-side API calls, admin operations, bypassing RLS

## Environment Variable Validation

The application uses Zod schemas for runtime validation of environment variables:

- **Production Mode**: Strict validation - missing or invalid variables cause startup failure
- **Development Mode**: Lenient validation with warnings and fallback values to keep dev server running
- **Legacy Support**: Automatic migration from deprecated variable names with console warnings

## Configuration Examples

### Development Environment (.env.local)
```bash
# Core Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-dev-project.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Application Configuration
NEXT_PUBLIC_APP_NAME=Vulcan MES (Dev)
NEXT_PUBLIC_APP_ENV=development

# Development Features (enabled for local development)
NEXT_PUBLIC_ENABLE_DEBUG_UI=true
NEXT_PUBLIC_ENABLE_MOCK_DATA=false

# Health Check Configuration (enabled for development monitoring)
NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=true
NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS=60000    # 1 minute for rapid feedback
NEXT_PUBLIC_DB_HEALTH_CHECK_MAX_INTERVAL_MS=600000  # 10 minutes

# Server-only
SUPABASE_SECRET=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Staging Environment
```bash
# Core Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-staging-project.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Application Configuration
NEXT_PUBLIC_APP_NAME=Vulcan MES (Staging)
NEXT_PUBLIC_APP_ENV=staging

# Debug features (may be enabled for testing)
NEXT_PUBLIC_ENABLE_DEBUG_UI=true
NEXT_PUBLIC_ENABLE_MOCK_DATA=false

# Health Check Configuration (balanced monitoring for staging)
NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=true
NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS=300000   # 5 minutes
NEXT_PUBLIC_DB_HEALTH_CHECK_MAX_INTERVAL_MS=3600000  # 1 hour

# Server-only
SUPABASE_SECRET=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Production Environment
```bash
# Core Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-prod-project.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Application Configuration
NEXT_PUBLIC_APP_NAME=Vulcan MES
NEXT_PUBLIC_APP_ENV=production

# Debug features MUST be disabled in production
NEXT_PUBLIC_ENABLE_DEBUG_UI=false
NEXT_PUBLIC_ENABLE_MOCK_DATA=false

# Health Check Configuration (disabled for performance unless critical monitoring needed)
NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=false
# NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS=300000   # Uncomment only if health checks enabled
# NEXT_PUBLIC_DB_HEALTH_CHECK_MAX_INTERVAL_MS=3600000

# Server-only
SUPABASE_SECRET=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## Production Security Guidelines

### Critical Production Requirements

1. **Mock Data Disabled**: `NEXT_PUBLIC_ENABLE_MOCK_DATA=false`
   - Using mock data in production will serve fake data to real users
   - This can cause data integrity issues and user confusion

2. **Debug UI Disabled**: `NEXT_PUBLIC_ENABLE_DEBUG_UI=false`
   - Debug UI can expose sensitive application state and performance metrics
   - May provide attack vectors for malicious users

3. **Environment Marking**: `NEXT_PUBLIC_APP_ENV=production`
   - Ensures production-specific code paths are taken
   - Disables development-only features and logging

4. **Health Check Management**: `NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK=false` (unless specifically required)
   - Health checks consume database connections and resources
   - Only enable for critical monitoring dashboards where real-time status is essential
   - Use conservative intervals (5+ minutes) when enabled to minimize database load

### Security Best Practices

- **Server Secrets**: Never commit `SUPABASE_SECRET` to version control
- **Environment Separation**: Use different Supabase projects for dev/staging/production
- **Key Rotation**: Regularly rotate Supabase keys, especially service role keys
- **Monitoring**: Monitor for unexpected environment variable usage in logs

## Troubleshooting

### Common Issues

1. **"Invalid Supabase URL" Error**
   - Check that `NEXT_PUBLIC_SUPABASE_URL` is a valid URL format
   - Ensure the URL includes the protocol (https://)

2. **Authentication Failures**
   - Verify `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY` matches your project
   - Check that `SUPABASE_SECRET` is correctly set for server-side operations

3. **Mock Data in Production**
   - Verify `NEXT_PUBLIC_ENABLE_MOCK_DATA=false` in production environment
   - Check deployment configuration and environment variable injection

4. **Debug UI Visible in Production**
   - Verify `NEXT_PUBLIC_ENABLE_DEBUG_UI=false` in production environment
   - Clear browser cache after environment variable changes

5. **Health Check Performance Issues**
   - Check `NEXT_PUBLIC_ENABLE_DB_HEALTH_CHECK` is disabled if not needed
   - Increase `NEXT_PUBLIC_DB_HEALTH_CHECK_INTERVAL_MS` if database load is high
   - Monitor database connection pool usage for health check impact

6. **Health Check Failures**
   - Verify database connectivity and Supabase configuration
   - Check that health check intervals are reasonable (not too frequent)
   - Review browser console for health check error messages

### Legacy Variable Migration

If you see warnings about legacy variables, update them:
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` → `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY`
- `SUPABASE_SERVICE_KEY` → `SUPABASE_SECRET`

The application supports both old and new names during the migration period, but new deployments should use the canonical names.

## Implementation Details

Environment validation is implemented in `/src/shared/lib/env.ts` using:
- **Zod Schemas**: Runtime validation with detailed error messages
- **Type Safety**: Full TypeScript support for all environment variables
- **Fallback Behavior**: Development-friendly defaults to prevent dev server crashes
- **Legacy Support**: Automatic migration from deprecated variable names